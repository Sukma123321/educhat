<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDUTING - AI Stunting Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #4D44DB;
            --accent: #FF6584;
            --light: #F8F9FF;
            --dark: #2D3748;
            --gray: #718096;
            --light-gray: #EDF2F7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.2rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(108, 99, 255, 0.3);
            z-index: 10;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 1.8rem;
        }
        
        .logo-text h1 {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .logo-text p {
            font-size: 0.75rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .chat-box {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background-color: var(--light);
            background-image: radial-gradient(circle at 10% 20%, rgba(108, 99, 255, 0.03) 0%, rgba(108, 99, 255, 0.03) 90%);
            scroll-behavior: smooth;
        }
        
        .message {
            margin-bottom: 1.2rem;
            max-width: 85%;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            display: flex;
            gap: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bot-message {
            align-self: flex-start;
        }
        
        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            margin-top: 4px;
        }
        
        .message-content-wrapper {
            display: flex;
            flex-direction: column;
        }
        
        .message-content {
            padding: 1rem 1.2rem;
            border-radius: 1.2rem;
            line-height: 1.5;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .bot-message .message-content {
            background-color: white;
            border-bottom-left-radius: 0.3rem;
            color: var(--dark);
            border: 1px solid var(--light-gray);
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-bottom-right-radius: 0.3rem;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--gray);
            margin-top: 0.3rem;
            padding: 0 0.5rem;
        }
        
        .user-message .message-time {
            text-align: right;
            color: var(--gray);
        }
        
        .input-area {
            padding: 1rem;
            background-color: white;
            border-top: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            position: relative;
        }
        
        #user-input {
            flex: 1;
            padding: 0.8rem 1.2rem;
            border: 1px solid var(--light-gray);
            border-radius: 2rem;
            outline: none;
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background-color: var(--light-gray);
            padding-right: 3rem;
        }
        
        #user-input:focus {
            border-color: var(--primary);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }
        
        #send-button {
            position: absolute;
            right: 1.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(108, 99, 255, 0.3);
        }
        
        #send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.4);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.2rem;
            background-color: white;
            border-radius: 1.2rem;
            border-bottom-left-radius: 0.3rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            width: fit-content;
            border: 1px solid var(--light-gray);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: var(--gray);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .welcome-message {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeIn 0.5s ease-out;
        }
        
        .welcome-message h2 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .welcome-message p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .footer {
            text-align: center;
            padding: 0.8rem;
            font-size: 0.75rem;
            color: var(--gray);
            background-color: white;
            border-top: 1px solid var(--light-gray);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .logo-text h1 {
                font-size: 1.2rem;
            }
            
            .chat-box {
                padding: 1rem;
            }
            
            .message {
                max-width: 90%;
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--light-gray);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        /* Floating action button */
        .fab {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(108, 99, 255, 0.3);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }
        
        .fab.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .fab:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>  
        <div class="chat-container">
            <div class="chat-box" id="chat-box">
                <div class="welcome-message">
                    <h2>Assalamualaikum wr wb!</h2>
                    <p>Saya EDUTING, asisten AI untuk edukasi stunting</p>
                </div>
                
                <div class="message bot-message">
                    <img src="https://cdn1.iconfinder.com/data/icons/bots/280/bot-10-2-512.png" class="message-avatar" alt="AI Avatar">
                    <div class="message-content-wrapper">
                        <div class="message-content">
                            Bismillahirohmanirohim. Saya siap membantu Anda memahami berbagai aspek tentang stunting. Apa yang ingin Anda ketahui?
                        </div>
                        <div class="message-time">Hari ini</div>
                    </div>
                </div>
            </div>
            
            <div class="input-area">
                <input type="text" id="user-input" placeholder="Tulis pertanyaan Anda..." autocomplete="off">
                <button id="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <div class="footer">
            
        </div>
    </div>
    
    <div class="fab" id="scroll-to-bottom">
        <i class="fas fa-arrow-down"></i>
    </div>

    <script>
        // =============================================
        // DEVELOPER: Replace with your actual Gemini API Key
        // Get it from: https://aistudio.google.com/
        const GEMINI_API_KEY = "AIzaSyAeeGrQkIyX6I9da85l8XTqNlVWgIK1I68"; 
        // =============================================

        // Chat functionality
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const scrollToBottomBtn = document.getElementById('scroll-to-bottom');
        
        // Scroll to bottom button visibility
        chatBox.addEventListener('scroll', () => {
            const isNearBottom = chatBox.scrollHeight - chatBox.scrollTop - chatBox.clientHeight > 100;
            scrollToBottomBtn.classList.toggle('visible', isNearBottom);
        });
        
        scrollToBottomBtn.addEventListener('click', () => {
            chatBox.scrollTop = chatBox.scrollHeight;
        });
        
        // Auto-scroll to bottom when new messages arrive
        function scrollToBottom() {
            chatBox.scrollTop = chatBox.scrollHeight;
            scrollToBottomBtn.classList.remove('visible');
        }
        
        // Get current time in HH:MM format
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const userText = userInput.value.trim();
            if (!userText) return;

            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.innerHTML = `
                <img src="https://cdn-icons-png.flaticon.com/512/9187/9187604.png" class="message-avatar" alt="User Avatar">
                <div class="message-content-wrapper">
                    <div class="message-content">${userText}</div>
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
            `;
            chatBox.appendChild(userMessage);
            userInput.value = '';
            scrollToBottom();

            // Add typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'message bot-message';
            typingIndicator.innerHTML = `
                <img src="https://cdn1.iconfinder.com/data/icons/bots/280/bot-10-2-512.png" class="message-avatar" alt="AI Avatar">
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatBox.appendChild(typingIndicator);
            scrollToBottom();

            try {
                // Call Gemini API
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Anda adalah EDUTING yang merupakan pakar ahli gizi dan stunting, memiliki kepribadian jujur, tidak egois, mudah bergaul, mudah menerima masukan, memiliki sudut pandang yang luas dan menghargai orang lain,asisten AI yang berfokus pada edukasi stunting  dibuat oleh Shohib Furqon Farizi sebagai guru dari SMA Unggulan Zainul Hasan BPPT Genggong. 
                                Berikan penjelasan yang runtut, mudah dipahami oleh berbagai kalangan, dan selalu berdasarkan referensi ilmiah minimal 5 tahun terakhir. Jawaban harus relevan, tidak bertele-tele, namun tetap ramah dan edukatif dalam bahasa Indonesia.
                                Fokus pada penjelasan tentang pencegahan, dampak, dan solusi stunting Sertakan kutipan ilmiah terbaru,buku,jurnal penelitian,website resmi minimal publikasi 5 tahun terakhir dari hari ini secara valid sertai kutipan format (Penulis,tahun) tanpa adanya catatan untuk mencari daftar pustaka tersebut. Kutipan jangan hanya WHO,BPS,UNICEF tapi juga kutipan jurnal terindeks,buku.
                                Pertanyaan: ${userText}`
                            }]
                        }],
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_ONLY_HIGH"
                            }
                        ],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1000
                        }
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error?.message || 'Gagal mendapatkan respons dari Gemini');
                }

                // Remove typing indicator
                chatBox.removeChild(typingIndicator);

                // Add bot response
                const botReply = data.candidates[0].content.parts[0].text;
                const botMessage = document.createElement('div');
                botMessage.className = 'message bot-message';
                botMessage.innerHTML = `
                    <img src="https://cdn1.iconfinder.com/data/icons/bots/280/bot-10-2-512.png" class="message-avatar" alt="AI Avatar">
                    <div class="message-content-wrapper">
                        <div class="message-content">${formatResponse(botReply)}</div>
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
                chatBox.appendChild(botMessage);
                scrollToBottom();
            } catch (error) {
                // Remove typing indicator
                chatBox.removeChild(typingIndicator);
                
                // Show error message
                const errorMessage = document.createElement('div');
                errorMessage.className = 'message bot-message';
                errorMessage.innerHTML = `
                    <img src="https://cdn1.iconfinder.com/data/icons/bots/280/bot-10-2-512.png" class="message-avatar" alt="AI Avatar">
                    <div class="message-content-wrapper">
                        <div class="message-content">Maaf, terjadi kesalahan: ${error.message}</div>
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
                chatBox.appendChild(errorMessage);
                scrollToBottom();
                console.error('Gemini API Error:', error);
            }
        }

        function formatResponse(text) {
            // Enhanced formatting for better readability
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // bold
                .replace(/\*(.*?)\*/g, '<em>$1</em>') // italic
                .replace(/^-\s(.*$)/gm, '<li>$1</li>') // list items
                .replace(/(\d+\.\s.*$)/gm, '<li>$1</li>') // numbered lists
                .replace(/\n\n/g, '</p><p>') // paragraphs
                .replace(/\n/g, '<br>') // line breaks
                .replace(/<p><li>/g, '<ul><li>') // start unordered lists
                .replace(/<\/li><\/p>/g, '</li></ul>') // end unordered lists
                .replace(/<p>(<li>.*?<\/li>)<\/p>/g, '<ul>$1</ul>'); // fix list wrapping
        }
        
        // Initial scroll to bottom
        scrollToBottom();
    </script>
</body>

</html>
